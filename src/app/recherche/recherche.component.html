<form [formGroup]="form" (ngSubmit)="onSubmit()" class="bg-white rounded-lg shadow-lg border border-slate-200 p-4">
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
    <div class="space-y-2 relative">
      <label
        for="depart"
        class="flex items-center gap-2 text-sm font-medium text-gray-700"
      >
        <lucide-icon [img]="MapPin" class="size-4 text-blue-600"></lucide-icon>
        Départ
      </label>
      <input
        id="depart"
        type="text"
        formControlName="departForm"
        autocomplete="off"
        (keyup)="onInput('depart')"
        name="Depart"
        placeholder="Gare de départ"
        class="flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent transition-all"
        required
      />
      @if (activeField === 'depart' && autoCompleteResults().length > 0) {
      <div
        class="absolute z-50 mt-1 w-full bg-white rounded-lg shadow-xl border border-gray-200 max-h-60 overflow-y-auto"
      >
        @for (ville of autoCompleteResults(); track $index) {
        <button
          type="button"
          (click)="selectSuggestion(ville)"
          class="block w-full text-left px-4 py-2 text-sm text-gray-800 hover:bg-blue-50 focus:outline-none focus:bg-blue-100 transition duration-150 ease-in-out border-b border-gray-100 last:border-0"
        >
          <div class="font-semibold">{{ ville.name }}</div>
        </button>
        }
      </div>
      }
    </div>

    <div class="space-y-2 relative">
      <label
        for="arrivee"
        class="flex items-center gap-2 text-sm font-medium text-gray-700"
      >
        <lucide-icon [img]="MapPin" class="size-4 text-blue-600"></lucide-icon>
        Arrivée
      </label>
      <input
        id="arrivee"
        type="text"
        autocomplete="off"
        formControlName="arriveForm"
        (keyup)="onInput('arrivee')"
        name="arrivee"
        placeholder="Arrivée"
        class="flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent transition-all"
        required
      />
      @if (activeField === 'arrivee' && autoCompleteResults().length > 0) {
      <div
        class="absolute z-50 mt-1 w-full bg-white rounded-lg shadow-xl border border-gray-200 max-h-60 overflow-y-auto"
      >
        @for (ville of autoCompleteResults(); track $index) {
        <button
          type="button"
          (click)="selectSuggestion(ville)"
          class="block w-full text-left px-4 py-2 text-sm text-gray-800 hover:bg-blue-50 focus:outline-none focus:bg-blue-100 transition duration-150 ease-in-out border-b border-gray-100 last:border-0"
        >
          <div class="font-semibold">{{ ville.name }}</div>
        </button>
        }
      </div>
      }
    </div>

    <div class="space-y-2">
      <label
        for="date"
        class="flex items-center gap-2 text-sm font-medium text-gray-700"
      >
        <lucide-icon
          [img]="Calendar"
          class="size-4 text-blue-600"
        ></lucide-icon>
        Date
      </label>
      <input
        id="date"
        type="date"
        formControlName="dateForm"
        name="date"
        class="flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent transition-all"
        required
      />
    </div>

    <div class="space-y-2">
      <label
        for="passagers"
        class="flex items-center gap-2 text-sm font-medium text-gray-700"
      >
        <lucide-icon [img]="Users" class="size-4 text-blue-600"></lucide-icon>
        Passagers
      </label>
      <input
        id="passagers"
        type="number"
        formControlName="nbpassagerForm"
        min="1"
        max="9"
        name="passagers"
        class="flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent transition-all"
      />
    </div>
  </div>
  @if (form.get('arriveForm')?.touched &&
  form.get('arriveForm')?.hasError('required')) {
  <p class="text-red-500 text-sm mb-4 font-medium p-2 bg-red-100 rounded">
    L'arrivée est requise.
  </p>
  } @if (form.get('departForm')?.touched &&
  form.get('departForm')?.hasError('required')) {
  <p class="text-red-500 text-sm mb-4 font-medium p-2 bg-red-100 rounded">
    Le départ est requis.
  </p>
  } @if (form.errors?.['differentPlaces'] && (form.get('arriveForm')?.touched ||
  form.get('departForm')?.touched || form.valid)) {
  <p class="text-red-500 text-sm mb-4 font-medium p-2 bg-red-100 rounded">
    ⚠️ Le départ et l'arrivée ne peuvent pas être la même gare !
  </p>
  }
  <button
    type="submit"
    class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium h-10 px-4 py-2 w-full bg-blue-600 text-white hover:bg-blue-700 shadow-md transition-colors focus:ring-2 focus:ring-offset-2 focus:ring-blue-600"
  >
    <lucide-icon [img]="Search" class="size-5 mr-2"></lucide-icon>
    Rechercher
  </button>
</form>
