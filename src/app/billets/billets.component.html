<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12 font-sans">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Mes billets</h1>
    <p class="text-slate-600">Consultez et gérez vos voyages réservés.</p>
  </div>

  <div class="space-y-6">
    @if (loading()) {
    <div class="flex justify-center items-center h-40">
      <div
        class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"
      ></div>
      <p class="ml-3 text-gray-600">Chargement de vos billets...</p>
    </div>
    } @else {

    <div
      class="flex w-full overflow-x-auto rounded-xl bg-gray-100 p-1 max-w-lg shadow-inner"
    >
      @for (tab of ['tous', 'a-venir', 'historique']; track tab) {
      <button
        (click)="setActiveTab(tab)"
        [ngClass]="{
          'bg-white text-gray-900 shadow-md': activeTab() === tab,
          'text-gray-600 hover:text-gray-800': activeTab() !== tab
        }"
        class="flex-1 min-w-[100px] px-3 py-2 text-sm font-medium rounded-xl transition-all duration-300 capitalize flex items-center justify-center space-x-1"
      >
        <span>
          {{
            tab === "tous"
              ? "Tous"
              : tab === "a-venir"
              ? "À venir"
              : "Historique"
          }}
        </span>
        <span
          [ngClass]="{
            'bg-indigo-500 text-white': activeTab() === tab,
            'bg-gray-200 text-gray-600': activeTab() !== tab
          }"
          class="ml-1 inline-flex items-center justify-center h-5 w-5 text-xs font-bold rounded-full transition-colors duration-200"
        >
          {{ getBilletCount(tab) }}
        </span>
      </button>
      }
    </div>

    <div class="space-y-4">
      @if (getBilletAffiche().length === 0) {
      <div
        class="p-12 text-center border border-dashed rounded-xl bg-white shadow-sm"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="size-8 text-indigo-400 mx-auto mb-4"
        >
          <path
            d="M14 17h1c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.7-2.1l-1.4-.5c-.8-.3-1.6-1.4-1.6-2.3V5c0-.6-.4-1-1-1H7c-.6 0-1 .4-1 1v2.1c0 .9-.8 2-1.6 2.3l-1.4.5C3.7 12.3 3 13.1 3 14v3c0 .6.4 1 1 1h2"
          />
          <path d="M5 17c0 1.1.9 2 2 2h4" />
          <path d="M17 19h-2" />
          <path d="M12 14v5" />
          <path d="M16 8h2" />
          <path d="M6 8h2" />
          <path d="M19 19c2 0 3 1 3 2" />
        </svg>
        <h3 class="font-semibold text-xl mb-2 text-gray-800">
          Aucun voyage dans cet onglet
        </h3>
        <p class="text-slate-600">
          @if (activeTab() === 'a-venir') { Prévoyez votre prochaine destination
          ! } @else if (activeTab() === 'historique') { C'est l'heure de se
          remémorer vos anciens voyages. } @else { Commencez par ajouter un
          billet. }
        </p>
      </div>
      } @else { @for (billet of getBilletAffiche(); track billet.id) {

      <div
        class="overflow-hidden border border-gray-200 rounded-xl bg-white shadow-lg hover:shadow-xl transition-shadow duration-300"
      >
        <div class="flex flex-col md:flex-row">
          <div
            [ngClass]="{
              'bg-indigo-50 text-indigo-600': isUpcoming(
                billet.voyage.dateArrive
              ),
              'bg-gray-50 text-gray-500': !isUpcoming(billet.voyage.dateArrive)
            }"
            class="flex items-center justify-center p-6 md:w-32 flex-shrink-0"
          >
            <div class="text-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="40"
                height="40"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="mx-auto"
              >
                <path
                  d="M12 21a2 2 0 0 0 2-2V8a2 2 0 0 0-4 0v11a2 2 0 0 0 2 2Z"
                />
                <path d="M18 8h2a1 1 0 0 0 0-2h-3v6" />
                <path d="M6 8H4a1 1 0 0 0 0 2h3v6" />
                <path d="M12 21v-4" />
                <path d="M20 19v-2" />
                <path d="M4 19v-2" />
                <path d="M12 4v2" />
              </svg>
              <p class="mt-2 text-xs font-semibold uppercase tracking-wider">
                TRAIN
              </p>
            </div>
          </div>

          <div class="flex-1 p-6">
            <div class="flex flex-col md:flex-row items-start justify-between">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2 flex-wrap">
                  <h3 class="font-extrabold text-2xl text-gray-900">
                    {{ billet.voyage.depart || "Départ Inconnu" }}
                  </h3>
                  <span class="text-slate-400 font-bold text-2xl">→</span>
                  <h3 class="font-extrabold text-2xl text-gray-900">
                    {{ billet.voyage.arrive || "Arrivée Inconnue" }}
                  </h3>
                </div>
                <div
                  class="flex flex-wrap gap-x-6 gap-y-2 text-slate-600 text-sm"
                >
                  <div class="flex items-center gap-2">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="size-4 text-indigo-500"
                    >
                      <path d="M8 2v4" />
                      <path d="M16 2v4" />
                      <rect width="18" height="18" x="3" y="4" rx="2" />
                      <path d="M3 10h18" />
                      <path d="M10 16h1" />
                      <path d="M14 16h1" />
                    </svg>
                    <span>
                      Départ:
                      {{ formatTicketDate(billet.voyage.dateDepart) }}
                    </span>
                  </div>
                  <div class="flex items-center gap-2">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="size-4 text-indigo-500"
                    >
                      <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                      <circle cx="9" cy="7" r="4" />
                      <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                      <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                    </svg>
                    <span
                      >{{ billet.voyage.nombreVoyageur || 1 }} Passager(s)</span
                    >
                  </div>
                </div>
              </div>

              <div class="mt-4 md:mt-0 md:text-right">
                <span
                  [ngClass]="{
                    'bg-green-100 text-green-700': isUpcoming(
                      billet.voyage.dateArrive
                    ),
                    'bg-gray-100 text-gray-600': !isUpcoming(
                      billet.voyage.dateArrive
                    )
                  }"
                  class="inline-flex items-center rounded-full px-4 py-1 text-sm font-semibold tracking-wide shadow-sm"
                >
                  {{
                    isUpcoming(billet.voyage.dateArrive) ? "À VENIR" : "TERMINÉ"
                  }}
                </span>
                <p class="text-2xl font-bold text-indigo-600 mt-2">100 euro</p>
              </div>
            </div>

            <div class="w-full h-px bg-gray-200 my-5"></div>

            <div class="flex items-center justify-between pt-2">
              <div class="flex items-center gap-4 text-sm text-slate-500">
                <span
                  >Réf. Billet:
                  <span class="font-mono text-gray-800">{{
                    billet.id
                  }}</span></span
                >
              </div>

              <button
                class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-red-600 border border-red-300 rounded-lg bg-white hover:bg-red-50 transition-colors duration-200 shadow-sm"
                title="Supprimer ce billet"
                (click)="deleteBillet(billet)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="size-4"
                >
                  <path d="M3 6h18" />
                  <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                  <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                  <line x1="10" x2="10" y1="11" y2="17" />
                  <line x1="14" x2="14" y1="11" y2="17" />
                </svg>
                Supprimer
              </button>
            </div>
          </div>
        </div>
      </div>
      } }
    </div>
    }
  </div>
</div>
